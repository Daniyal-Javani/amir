#!/usr/bin/python
# -*- coding: utf-8 -*-
# Copyright (C) 2010 <jooyeshgar> <info@jooyeshgar.com>
#This program is free software: you can redistribute it and/or modify it 
#under the terms of the GNU General Public License version 3, as published 
#by the Free Software Foundation.
#
#This program is distributed in the hope that it will be useful, but 
#WITHOUT ANY WARRANTY; without even the implied warranties of 
#MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR 
#PURPOSE.  See the GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License along 
#with this program.  If not, see <http://www.gnu.org/licenses/>.

#!/usr/bin/env python

import sys
import os
import pygtk
pygtk.require('2.0')
import gtk
import gettext,locale
import gobject

# Check if we are working in the source tree or from the installed 
# package and mangle the python path accordingly
if os.path.dirname(sys.argv[0]) != ".":
    if sys.argv[0][0] == "/":
        fullPath = os.path.dirname(sys.argv[0])
    else:
        fullPath = os.getcwd() + "/" + os.path.dirname(sys.argv[0])
else:
    fullPath = os.getcwd()
sys.path.insert(0, os.path.dirname(fullPath))

from amir.amirconfig import config
from amir import subjects, addeditdoc, database, numberentry, notebookreport, docreport, setting, helpers
     
class MainWindow:

    def manualDocument(self, sender):
        dialog = addeditdoc.AddEditDoc()

    def quitMainWindow(self, sender):
        pass
    
    def dailyNotebookReport(self, sender):
        reportwin = notebookreport.NotebookReport()
    
    def ledgerNotebookReport(self, sender):
        reportwin = notebookreport.NotebookReport(notebookreport.NotebookReport.LEDGER)
    
    def subledgerNotebookReport(self, sender):
        reportwin = notebookreport.NotebookReport(notebookreport.NotebookReport.SUBLEDGER)
            
    def documentReport(self, sender):
        reportwin = docreport.DocumentReport()
        
    def aboutAmir(self, sender):
        pass
    def manageSubjects(self, sender):
        dialog = subjects.Subjects()
        
    def editDocument(self, sender):
        dialog = self.builder.get_object("selectdoc")        
        res = dialog.run()
        dialog.hide()
        if res != gtk.RESPONSE_CANCEL:
            dialog = addeditdoc.AddEditDoc(int(unicode(self.numentry.get_text())))
            
        
    def settingsDialog(self, sender):
        window = setting.Setting()
    
    def view_toolbar(self, sender):
        dialog = subjects.Subjects()

    def delete_event(self, widget, event, data=None):
        
     ##TODO uncomment later  
        #=======================================================================
        # msgbox = gtk.MessageDialog(self.window, gtk.DIALOG_MODAL, gtk.MESSAGE_WARNING, gtk.BUTTONS_OK_CANCEL, "Are you sure to close the app?")
        # msgbox.set_title("Are you sure?")
        # result = msgbox.run();
        # if result == gtk.RESPONSE_CANCEL :
        #    msgbox.destroy()
        #    return True
        # else :
        #    return False
        #=======================================================================

        return False
        # Change FALSE to TRUE and the main window will not be destroyed
        # with a "delete_event".

    def destroy(self, widget, data=None):
        conffile = config.configfile
        config.updateConfigFile()
        gtk.main_quit()

    def __init__(self):
        gobject.threads_init()
        #gtk.widget_set_default_direction(gtk.TEXT_DIR_RTL)

        self.builder = helpers.get_builder("mainwin")
        self.window = self.builder.get_object("window1")
        self.numentry = numberentry.NumberEntry()
        box = self.builder.get_object("numbox")
        box.add(self.numentry)
        self.numentry.show()
        
        initial = self.builder.get_object("menubar2")
        initial.hide()
        self.builder.connect_signals(self)
        
        self.window.connect("delete_event", self.delete_event)
        self.window.connect("destroy", self.destroy)
        self.window.set_border_width(10)
        self.window.show()

    def main(self):
        gtk.main()

if __name__ == "__main__":
     #locale.setlocale(locale.LC_ALL, '')
     #==========================================================================
     # #gettext.install('amir', '/usr/share/locale', unicode=1)
     # #locale.bindtextdomain('amir', '/usr/share/locale')
     # gettext.bindtextdomain('amir', '/usr/share/locale')
     # gettext.textdomain('amir')
     # #lang = gettext.translation('amir', '/usr/share/locale')
     # _ = gettext.gettext
     #==========================================================================
     gettext.install('amir', '/usr/share/locale')


     mainwin = MainWindow()
     mainwin.main()

